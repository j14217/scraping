{% extends "./base.html" %}
{% block body %}
<form action="" method="POST">
    {% csrf_token %}

    <table>
    {{form.as_table}}
    </table>

    <input type="submit" value="検索">
</form>

<div class="paginate">
    <div class="contents">
{% if contacts.has_previous %}
        <a href="../result?page={{ contacts.previous_page_number }}">前へ</a>
{% endif %}

{% for num in contacts.paginator.page_range %} 
{% ifequal num entry.number %}
{{ num }}
{% else %}
        <a href="../result?page={{ num }}">{{ num }}</a>
{% endifequal %}
{% endfor %}


{% if contacts.has_next %}
        <a href="../result?page={{ contacts.next_page_number }}">次へ</a>
{% endif %}
    </div>
</div>

<div class="result"></div>

<script type="text/javascript">
    $(function(){
        //ページを表示させる箇所の設定
        var $content = $('.result');
        //ボタンをクリックした時の処理
        $(document).on('click', '.paginate a', function(event) {
            event.preventDefault();
            //.gnavi aのhrefにあるリンク先を保存
            var link = $(this).attr("href");
            //リンク先が今と同じであれば遷移しない
            if(link == lastpage){
                return false;
            }else{
                $content.fadeOut(600, function() {
                    getPage(link);
                });
                //今のリンク先を保存
                lastpage = link;
            }
            
        });
        //初期設定
        getPage("../result?page=1");
        var lastpage = "../result?page=1.html";

        //ページを取得してくる
        function getPage(elm){
            $.ajax({
                type: 'GET',
                url: elm,
                dataType: 'html',
                success: function(data){
                    $content.html(data).fadeIn(600);
                },
                error:function() {
                       }
            });
        }
    });
</script>
{% endblock %}

